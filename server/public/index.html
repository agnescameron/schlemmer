<!DOCTYPE HTML> <html lang="en"> 

<head> <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
<link rel="stylesheet" href="assets/css/main.css">
<title>s t i c k d a n c e</title> 
</head> 
<body id='body'> 

<button onClick=createAudio()>clickme</button>

</body>

<!-- <script src="assets/js/index.js"></script> -->
<script>
(function() {
	window.AudioContext = window.AudioContext || window.webkitAudioContext;
	if (window.AudioContext) {
		window.audioContext = new window.AudioContext();
	}
	var fixAudioContext = function (e) {
		if (window.audioContext) {
			// Create empty buffer
			var buffer = window.audioContext.createBuffer(1, 1, 22050);
			var source = window.audioContext.createBufferSource();
			source.buffer = buffer;
			// Connect to output (speakers)
			source.connect(window.audioContext.destination);
			// Play sound
			if (source.start) {
				source.start(0);
			} else if (source.play) {
				source.play(0);
			} else if (source.noteOn) {
				source.noteOn(0);
			}
		}
		// Remove events
		document.removeEventListener('touchstart', fixAudioContext);
		document.removeEventListener('touchend', fixAudioContext);
	};
	// iOS 6-8
	document.addEventListener('touchstart', fixAudioContext);
	// iOS 9
	document.addEventListener('touchend', fixAudioContext);
})();


    var ws1 = new WebSocket('ws://10.0.1.2:40510');
    // event emmited when connected
    ws1.onopen = function () {
        console.log('websocket 1 is connected ...')
        // sending a send event to websocket server
        ws1.send('connected')
    }
    // event emmited when receiving message 
    ws1.onmessage = function (ev) {
    	var result = ev.data.substring(1, ev.data.length-1);
    	result = result.replace(/\s/g, '');
    	var data = result.split(",")
    	changeSound1(data);
    }



    var ws2 = new WebSocket('ws://10.0.1.2:40511');
    // event emmited when connected
    ws2.onopen = function () {
        console.log('websocket 2 is connected ...')
        // sending a send event to websocket server
        ws2.send('connected')
    }
    // event emmited when receiving message 
    ws2.onmessage = function (ev) {
    	var result = ev.data.substring(1, ev.data.length-1);
    	result = result.replace(/\s/g, '');
    	var data = result.split(",")
    	changeSound2(data);
    }


	var context1 = new AudioContext()

	var o1 = context1.createOscillator()
	var  g1 = context1.createGain()
	o1.connect(g1)
	g1.connect(context1.destination)
	o1.start(0);

	var context2 = new AudioContext()

	var o2 = context2.createOscillator()
	var  g2 = context2.createGain()
	o2.connect(g2)
	g2.connect(context2.destination)
	o2.start(0);

	var body = document.getElementById('body')
	console.log(body)

	function changeSound1(note) {
		if(note === undefined){
			o1.frequency.value = parseFloat(600);
		}
		else
			o1.frequency.value = parseFloat(Math.round(note[1]/500)%900)*4+100;
	}

	function changeSound2(note) {
		if(note === undefined){
			o2.frequency.value = parseFloat(600);
		}
		else
			o2.frequency.value = parseFloat(Math.round(note[1]/500)%900)*4+100;
	}

	function createAudio(){
	    context1.resume();
	    context2.resume();
	  }
	// setInterval(changeSound, soundPeriod);

	// One-liner to resume playback when user interacted with the page.
	document.addEventListener('click', function() {
	  context.resume().then(() => {
	    console.log('Playback resumed successfully');
	  });
	});
</script>
</html>