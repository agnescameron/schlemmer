<!DOCTYPE HTML> <html lang="en"> 

<head> <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
<link rel="stylesheet" href="assets/css/main.css">
<title>s t i c k d a n c e</title> 
</head> 
<body id='body'> 

</body>

<!-- <script src="assets/js/index.js"></script> -->
<script>
(function() {
	window.AudioContext = window.AudioContext || window.webkitAudioContext;
	if (window.AudioContext) {
		window.audioContext = new window.AudioContext();
	}
	var fixAudioContext = function (e) {
		if (window.audioContext) {
			// Create empty buffer
			var buffer = window.audioContext.createBuffer(1, 1, 22050);
			var source = window.audioContext.createBufferSource();
			source.buffer = buffer;
			// Connect to output (speakers)
			source.connect(window.audioContext.destination);
			// Play sound
			if (source.start) {
				source.start(0);
			} else if (source.play) {
				source.play(0);
			} else if (source.noteOn) {
				source.noteOn(0);
			}
		}
		// Remove events
		document.removeEventListener('touchstart', fixAudioContext);
		document.removeEventListener('touchend', fixAudioContext);
	};
	// iOS 6-8
	document.addEventListener('touchstart', fixAudioContext);
	// iOS 9
	document.addEventListener('touchend', fixAudioContext);
})();


    var ws = new WebSocket('ws://localhost:40510');
    // event emmited when connected
    ws.onopen = function () {
        console.log('websocket is connected ...')
        // sending a send event to websocket server
        ws.send('connected')
    }
    // event emmited when receiving message 
    ws.onmessage = function (ev) {
    	var result = ev.data.substring(1, ev.data.length-1);
    	result = result.replace(/\s/g, '');
    	var data = result.split(",")
    	changeSound(data);
    }

	var context = new AudioContext()

	var o = context.createOscillator()
	var  g = context.createGain()
	o.connect(g)
	g.connect(context.destination)
	o.start(0);

	var body = document.getElementById('body')
	console.log(body)

	function changeSound(note) {
		if(note === undefined){
			o.frequency.value = parseFloat(600);
		}
		else
			o.frequency.value = parseFloat(Math.round(note[1]/500)%900)*5+100;
	}

	// setInterval(changeSound, soundPeriod);

	// One-liner to resume playback when user interacted with the page.
	document.addEventListener('click', function() {
	  context.resume().then(() => {
	    console.log('Playback resumed successfully');
	  });
	});
</script>
</html>